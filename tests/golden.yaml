---
# Source: test-chart/templates/all.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: test-app-main
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "network-policy"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: test-release
      app.kubernetes.io/name: test-app
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            kubernetes.io/metadata.name: istio-system
        podSelector:
          matchLabels:
            app.kubernetes.io/name: shared-platform-gateway
      ports:
      - port: 80
        protocol: TCP
      - port: 15008
        protocol: TCP
  egress:
    - ports:
      - port: 53
        protocol: UDP
      - port: 53
        protocol: TCP
      to:
      - namespaceSelector:
          matchLabels:
            kubernetes.io/metadata.name: kube-system
    - ports:
      - port: 80
        protocol: TCP
      - port: 443
        protocol: TCP
      to:
      - ipBlock:
          cidr: 0.0.0.0/0
          except:
          - 10.42.0.0/16
          - 10.43.0.0/16
---
# Source: test-chart/templates/all.yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: test-app
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "pod-disruption-budget"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: test-release
      app.kubernetes.io/name: test-app
  minAvailable: 1
---
# Source: test-chart/templates/all.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: test-service-account
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "serviceaccount"
  annotations:
    test.serviceaccount.annotation: test-value
automountServiceAccountToken: false
---
# Source: test-chart/templates/all.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-app-app-config
  namespace: test-namespace
  labels:
    app.kubernetes.io/component: config
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
  annotations:
    config.hash: abc123
data:
  config.yaml: |
    key: value
    setting: test
  env: test
---
# Source: test-chart/templates/all.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-app-extra
  namespace: test-namespace
  labels:
    app.kubernetes.io/component: config
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
data:
  extra.conf: option=value
---
# Source: test-chart/templates/all.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: test-app-config
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "pvc"
  annotations:
    helm.sh/resource-policy: keep
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: local-path
  resources:
    requests:
      storage: 1Gi
---
# Source: test-chart/templates/all.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: test-app-data
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "pvc"
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: local-path
  resources:
    requests:
      storage: 10Gi
---
# Source: test-chart/templates/all.yaml
apiVersion: v1
kind: Service
metadata:
  name: test-app-main
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: service-main
  annotations:
    test.annotation: test-value
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 80
      targetPort: 8080
      protocol: TCP
    - name: metrics
      port: 9100
      targetPort: 9100
      protocol: TCP
  selector:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
---
# Source: test-chart/templates/all.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: test-app
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "deployment"
spec:
  replicas: 2
  revisionHistoryLimit: 5
  strategy:
    type: RollingUpdate
  selector:
    matchLabels:
      app.kubernetes.io/instance: test-release
      app.kubernetes.io/name: test-app
  template:
    metadata:
      labels:
        app.kubernetes.io/instance: test-release
        app.kubernetes.io/name: test-app
        app.kubernetes.io/part-of: test-stack
        app.kubernetes.io/version: custom-version-override
        helm.sh/chart: test-chart-1.0.0
        app.kubernetes.io/component: deployment
        test.pod.label: test-value
    spec:
      imagePullSecrets:
        - name: test-registry-secret
      terminationGracePeriodSeconds: 60
      securityContext:
        fsGroup: 20000
        runAsNonRoot: true
        runAsUser: 20000
        seccompProfile:
          type: RuntimeDefault
      serviceAccountName: test-service-account
      dnsPolicy: ClusterFirst
      automountServiceAccountToken: false
      enableServiceLinks: false
      initContainers:
        - name: init
          image: busybox:1.36.1
          imagePullPolicy: Always
          command:
            - sh
            - -c
            - echo "Initializing..."
          resources:
            limits:
              cpu: 100m
              memory: 128Mi
            requests:
              cpu: 50m
              memory: 64Mi
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 20000
            seccompProfile:
              type: RuntimeDefault
      containers:
        - name: app
          image: nginx:1.25
          imagePullPolicy: Always
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
            - name: metrics
              containerPort: 9100
              protocol: TCP
          env:
            - name: ENV_VAR
              value: test-value
          resources:
            limits:
              cpu: 200m
              memory: 256Mi
            requests:
              cpu: 100m
              memory: 128Mi
          livenessProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /ready
              port: 8080
            initialDelaySeconds: 5
            periodSeconds: 5
          startupProbe:
            failureThreshold: 30
            httpGet:
              path: /startup
              port: 8080
            initialDelaySeconds: 10
            periodSeconds: 5
          securityContext:
            allowPrivilegeEscalation: false
            appArmorProfile:
              type: RuntimeDefault
            capabilities:
              drop:
              - ALL
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 20000
            seccompProfile:
              type: RuntimeDefault
      volumes:
        -
          name: config
          persistentVolumeClaim:
            claimName: test-app-config
        -
          name: data
          persistentVolumeClaim:
            claimName: test-app-data
        -
          name: nfs-share
          nfs:
            path: /mnt/shared
            server: nfs.example.com
---
# Source: test-chart/templates/all.yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: test-app-ingress
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "authorization-policy"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: test-release
      app.kubernetes.io/name: test-app
  action: ALLOW
  rules:
    - from:
      - source:
          principals:
          - cluster.local/ns/istio-system/sa/shared-platform-gateway-istio
      to:
      - operation:
          ports:
          - "80"
---
# Source: test-chart/templates/all.yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: test-app-prometheus
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "authorization-policy"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: test-release
      app.kubernetes.io/name: test-app
  action: ALLOW
  rules:
    - from:
      - source:
          principals:
          - cluster.local/ns/monitoring/sa/prometheus-kube-prometheus-prometheus
      to:
      - operation:
          ports:
          - "9100"
---
# Source: test-chart/templates/all.yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: test-app
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "destination-rule"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  host: test-app.test-namespace.svc.cluster.local
  trafficPolicy:
    connectionPool:
      http:
        http1MaxPendingRequests: 20
        http2MaxRequests: 200
        maxRequestsPerConnection: 4
      tcp:
        maxConnections: 200
    outlierDetection:
      baseEjectionTime: 60s
      consecutive5xxErrors: 10
      interval: 60s
      maxEjectionPercent: 75
---
# Source: test-chart/templates/all.yaml
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: test-app-test-dashboard
  namespace: test-namespace
  labels:
    app.kubernetes.io/component: grafana-dashboard
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
spec:
  instanceSelector:
    matchLabels:
      dashboards: grafana-a
  json: |
    {"annotations":{"list":[]},"id":null,"links":[],"panels":[{"gridPos":{"h":8,"w":12,"x":0,"y":0},"id":1,"targets":[{"expr":"rate(http_requests_total[5m])","legendFormat":"{{instance}}"}],"title":"Request Rate","type":"graph"}],"refresh":"30s","schemaVersion":17,"tags":["test","application"],"templating":{"list":[]},"time":{"from":"now-6h","to":"now"},"timepicker":{"refresh_intervals":[],"time_options":[]},"timezone":"browser","title":"Test Application Dashboard","version":0}
---
# Source: test-chart/templates/all.yaml
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: test-app-route
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "http-route"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  parentRefs:
    - name: shared-platform-gateway
      namespace: istio-system
      kind: Gateway
      group: gateway.networking.k8s.io
      sectionName: https
  hostnames:
    - test-app.example.com
  rules:
    -
      matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - group: ""
          kind: Service
          name: test-app
          port: 80
          weight: 100
---
# Source: test-chart/templates/all.yaml
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: test-app-http-redirect
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "http-route"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  parentRefs:
    - name: shared-platform-gateway
      namespace: istio-system
      kind: Gateway
      group: gateway.networking.k8s.io
      sectionName: http
  hostnames:
    - test-app.example.com
  rules:
    -
      matches:
        - path:
            type: PathPrefix
            value: /
      filters:
        - requestRedirect:
            scheme: https
            statusCode: 301
          type: RequestRedirect
---
# Source: test-chart/templates/all.yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: test-app
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "prometheus-rule"

spec:
  groups:
    - name: test-app.rules
      rules:
        - alert: TestAlert
          annotations:
            description: Test service has been down for more than 5 minutes
            summary: Test service is down
          expr: up == 0
          for: 5m
          labels:
            severity: critical
---
# Source: test-chart/templates/all.yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: api-key
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "sealed-secret"
spec:
  encryptedData:
    apiKey: "AgBy3i4OJSWK+PiTySYZZA9rO43cGDEQAx..."
  template:
    metadata:
      name: api-key
      namespace: test-namespace
      labels:
        app.kubernetes.io/instance: test-release
        app.kubernetes.io/name: test-app
        app.kubernetes.io/part-of: test-stack
        app.kubernetes.io/version: custom-version-override
        helm.sh/chart: test-chart-1.0.0
    type: Opaque
---
# Source: test-chart/templates/all.yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: test-secret
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "sealed-secret"
  annotations:
    sealedsecrets.bitnami.com/managed: "true"
spec:
  encryptedData:
    password: "AgBy3i4OJSWK+PiTySYZZA9rO43cGDEQAx..."
    username: "AgBy3i4OJSWK+PiTySYZZA9rO43cGDEQAx..."
  template:
    metadata:
      name: test-secret
      namespace: test-namespace
      labels:
        app.kubernetes.io/instance: test-release
        app.kubernetes.io/name: test-app
        app.kubernetes.io/part-of: test-stack
        app.kubernetes.io/version: custom-version-override
        helm.sh/chart: test-chart-1.0.0
        app.kubernetes.io/component: "secrets"
      annotations:
        sealedsecrets.bitnami.com/cluster-wide: "true"
    type: Opaque
---
# Source: test-chart/templates/all.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: test-app
  namespace: test-namespace
  labels:
    app.kubernetes.io/instance: test-release
    app.kubernetes.io/name: test-app
    app.kubernetes.io/part-of: test-stack
    app.kubernetes.io/version: custom-version-override
    helm.sh/chart: test-chart-1.0.0
    app.kubernetes.io/component: "servicemonitor"
  annotations:
    argocd.argoproj.io/sync-wave: "2"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: test-release
      app.kubernetes.io/name: test-app
  namespaceSelector:
    matchNames:
    - default
  endpoints:
    - port: metrics
      interval: 15s
      scrapeTimeout: 10s
      path: /metrics
      honorLabels: true
      relabelings:
        - action: replace
          sourceLabels:
          - __meta_kubernetes_pod_name
          targetLabel: pod_name
      metricRelabelings:
        - action: replace
          replacement: test-app
          targetLabel: service
        - action: replace
          replacement: test-component
          targetLabel: component
