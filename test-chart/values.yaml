# Default values for test-chart
# Test harness chart that wraps libChart for rendering and validating templates.
# All values are passed directly to libChart - no prefix needed.

# ----------------------------------------------------------------------------
# Global Configuration
# ----------------------------------------------------------------------------
global:
  name: "changeme"  # REQUIRED - application name (e.g., "radarr", "sonarr"); override when installing
  namespace: "test-namespace"  # Namespace for all resources (default should not be used per CKV_K8S_21)
  # Optional - parent chart information (for correct labels)
  chart:
    name: ""  # Parent chart name (e.g., "radarr")
    version: ""  # Parent chart version (e.g., "0.1.0")
    appVersion: ""  # Parent chart appVersion
  labels:
    partOf: ""  # Optional - name of higher level application (e.g., "media-center")
    overrides: {}  # Optional - map to override metadata labels (selector labels name/instance are reserved)

# ----------------------------------------------------------------------------
# Deployment Configuration
# ----------------------------------------------------------------------------
deployment:
  replicas: 1
  strategy:
    type: Recreate
  revisionHistoryLimit: 3
  imagePullSecrets: []
  terminationGracePeriodSeconds: 30
  podLabels: {}
  automountServiceAccountToken: false
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 20000  # High UID to avoid host conflicts (CKV_K8S_40)
    fsGroup: 20000
    seccompProfile:
      type: RuntimeDefault
  defaultContainerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    runAsUser: 20000  # High UID to avoid host conflicts (CKV_K8S_40)
    capabilities:
      drop:
        - ALL
    seccompProfile:
      type: RuntimeDefault
    appArmorProfile:
      type: RuntimeDefault
  containers:  # REQUIRED - must be defined by application chart
    app:
      enabled: true
      image:
        repository: changeme   # override when installing
        tag: "1.0.0"
      resources:
        requests:
          memory: "128Mi"
          cpu: "100m"
        limits:
          memory: "256Mi"
          cpu: "200m"
      livenessProbe:
        httpGet:
          path: /healthz
          port: 8080
        initialDelaySeconds: 30
        periodSeconds: 10
      readinessProbe:
        httpGet:
          path: /ready
          port: 8080
        initialDelaySeconds: 5
        periodSeconds: 5
  initContainers: {}

# ----------------------------------------------------------------------------
# Feature: Persistence
# ----------------------------------------------------------------------------
persistence:
  enabled: false
  claims: {}  # Map of PVC definitions
  volumes: []  # List of volume definitions

# ----------------------------------------------------------------------------
# Feature: Observability
# ----------------------------------------------------------------------------
metrics:
  enabled: false
  serviceMonitor:
    enabled: true
    port: 9100
    portName: "metrics"
    interval: "10s"
    scrapeTimeout: "5s"
    path: ""
    honorLabels: false
    selector: {}
    namespaceSelector: {}
    relabelings: []
    metricRelabelings: []
  prometheusRule:
    enabled: true
    rules: []
  grafana:
    enabled: false
    instanceSelector:
      matchLabels:
        dashboards: "grafana-a"
    dashboard:
      enabled: false
      items:
        example-dashboard:
          enabled: false
          name: "example-dashboard"
          file: "example-dashboard.json"
          # Optional: Override instanceSelector for this specific dashboard
          # instanceSelector:
          #   matchLabels:
          #     dashboards: "specific-grafana"
          # Optional: Folder assignment
          # folder: "Application Dashboards"
          # folderUID: "app-dashboards-uid"
          # folderRef: "grafana-folder-resource"

# ----------------------------------------------------------------------------
# Service Account
# ----------------------------------------------------------------------------
serviceAccount:
  create: true
  automount: false
  annotations: {}
  name: ""

# ----------------------------------------------------------------------------
# Pod disruption budget configuration
# ----------------------------------------------------------------------------
podDisruptionBudget:
  enabled: false
  minAvailable: null
  maxUnavailable: null

# ----------------------------------------------------------------------------
# Network Configuration
# ----------------------------------------------------------------------------
network:
  enabled: true
  httpRoute:
    enabled: false
    host: ""
    port: 80
    gateway:
      name: shared-platform-gateway
      namespace: istio-system
    # Example routes:
    # - name: route
    #   enabled: true
    #   listener:
    #     sectionName: https
    #   rules:
    #     - matches:
    #         - path:
    #             type: PathPrefix
    #             value: /
    #       backendRefs:
    #         - name: "{{ .Values.global.name }}"
    #           port: 80
    #           weight: 100
    #           group: ""
    #           kind: Service
    routes: []
  # NetworkPolicy Configuration - Multiple policies support
  # NOTE: NetworkPolicy is disabled by default to avoid breaking unit tests.
  # Enable it in production charts or when running Checkov scans.
  # Example:
  #   items:
  #     default:
  #       enabled: true
  #       policyTypes: [Ingress, Egress]
  #       ingress: []
  #       egress: []
  networkPolicy:
    items: {}
  # Service Configuration - Multiple services support
  # Example:
  #   items:
  #     "":                    # Empty string uses global.name as service name
  #       enabled: true
  #       type: ClusterIP
  #       ports:
  #         http:
  #           port: 80
  #           targetPort: 8080
  #           protocol: TCP
  #       annotations: {}
  services:
    items: {}
  # Istio Configuration
  istio:
    enabled: true
    authorizationPolicy:
      enabled: false  # Feature flag - enable AuthorizationPolicy generation
      # Example:
      #   items:
      #     default:
      #       enabled: true
      #       action: ALLOW
      #       rules:
      #         - from:
      #             - source:
      #                 principals:
      #                   - "cluster.local/ns/istio-system/sa/shared-platform-gateway-istio"
      #           to:
      #             - operation:
      #                 ports: ["80"]
      items: {}
    destinationRule:
      enabled: false  # Feature flag - enable DestinationRule (Circuit Breaker) generation
      trafficPolicy:
        connectionPool:
          tcp:
            maxConnections: 100
          http:
            http1MaxPendingRequests: 10
            http2MaxRequests: 100
            maxRequestsPerConnection: 2
        outlierDetection:
          consecutive5xxErrors: 5
          interval: 30s
          baseEjectionTime: 30s
          maxEjectionPercent: 50
