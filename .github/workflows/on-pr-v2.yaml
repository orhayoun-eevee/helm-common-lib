name: PR Validation

on:
  pull_request:
    branches:
      - main

jobs:
  # Validate libChart (library chart)
  validate-lib:
    name: Validate libChart
    uses: orhayoun-eevee/build-workflow/.github/workflows/on-pr-flow-v2.yaml@main
    with:
      chart_path: libChart
      run_lint: true
      run_ct_lint: true
      run_tests: false          # Library charts don't have unit tests directly
      run_golden: false         # Library charts don't generate manifests
      run_kubeconform: false
      run_checkov: false
      run_version_check: true
    secrets: inherit

  # Validate test-chart (test harness for libChart)
  validate-test:
    name: Validate test-chart
    uses: orhayoun-eevee/build-workflow/.github/workflows/on-pr-flow-v2.yaml@main
    with:
      chart_path: test-chart
      run_lint: true
      run_ct_lint: false        # Only need ct lint on libChart
      run_tests: true
      run_golden: true
      run_kubeconform: true
      run_checkov: true
      run_version_check: false  # test-chart version follows libChart
      golden_file: tests/golden.yaml
      values_file: tests/values.test.yaml
    secrets: inherit
    needs: validate-lib         # Run after libChart validated
